.\" Automatically generated by Pandoc 1.19.2.4
.\"
.TH "HAPPYEYEBALLS_CONNECT" "3" "" "libdill" "libdill Library Functions"
.hy
.SH NAME
.PP
happyeyeballs_connect \- creates a TCP connection using Happy Eyeballs
algorithm
.SH SYNOPSIS
.IP
.nf
\f[C]
#include\ <libdill.h>

int\ happyeyeballs_connect(
\ \ \ \ const\ char*\ name,
\ \ \ \ int\ port,
\ \ \ \ int64_t\ deadline);
\f[]
.fi
.SH DESCRIPTION
.PP
Happy Eyeballs protocol (RFC 8305) is a way to create a TCP connection
to a remote endpoint even if some of the IP addresses associated with
the endpoint are not accessible.
.PP
First, DNS queries to IPv4 and IPv6 addresses are launched in parallel.
Then a connection is attempted to the first address, with IPv6 address
being preferred.
If the connection attempt doesn\[aq]t succeed in 300ms connection to
next address is attempted, alternating between IPv4 and IPv6 addresses.
However, the first connection attempt isn\[aq]t caneled.
If, in the next 300ms, none of the previous attempts succeeds connection
to the next address is attempted, and so on.
First successful connection attempt will cancel all other connection
attemps.
.PP
This function executes the above protocol and returns the newly created
TCP connection.
.PP
\f[B]name\f[]: Name of the host to connect to.
.PP
\f[B]port\f[]: Port to connect to.
.PP
\f[B]deadline\f[]: A point in time when the operation should time out,
in milliseconds.
Use the \f[B]now\f[] function to get your current point in time.
0 means immediate timeout, i.e., perform the operation if possible or
return without blocking if not.
\-1 means no deadline, i.e., the call will block forever if the
operation cannot be performed.
.SH RETURN VALUE
.PP
In case of success the function returns newly created TCP connection.
In case of error it returns \-1 and sets \f[B]errno\f[] to one of the
values below.
.SH ERRORS
.IP \[bu] 2
\f[B]ECANCELED\f[]: Current coroutine was canceled.
.IP \[bu] 2
\f[B]EINVAL\f[]: Invalid argument.
.IP \[bu] 2
\f[B]EMFILE\f[]: The maximum number of file descriptors in the process
are already open.
.IP \[bu] 2
\f[B]ENFILE\f[]: The maximum number of file descriptors in the system
are already open.
.IP \[bu] 2
\f[B]ENOMEM\f[]: Not enough memory.
.IP \[bu] 2
\f[B]ETIMEDOUT\f[]: Deadline was reached.
.SH EXAMPLE
.IP
.nf
\f[C]
int\ s\ =\ happyeyeballs_connect("www.example.org",\ 80,\ \-1);
int\ rc\ =\ bsend(s,\ "GET\ /\ HTTP/1.1",\ 14,\ \-1);
\f[]
.fi
.SH SEE ALSO
.PP
\f[B]now\f[](3)
